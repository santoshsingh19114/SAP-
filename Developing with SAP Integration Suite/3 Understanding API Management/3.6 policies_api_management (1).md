# Policies in SAP API Management

## Objective
After completing this lesson, you will be able to understand and use policies to define the behavior of APIs in SAP Integration Suite.

---

# 1. What Are Policies?
Policies are programs that execute specific functions at runtime to modify, secure, transform, or control API behavior.

### Key Capabilities of Policies
- Add functionalities without coding.
- Secure APIs (authentication, authorization).
- Control traffic (quota, spike arrest, rate limiting).
- Transform messages (JSON/XML mapping, XSLT).
- Implement scripting logic (JavaScript/Python).
- Improve observability (logging, analytics).

### Where Policies Apply
Policies can be applied on:
- **Request flow** or **response flow**
- **Proxy endpoint** or **Target endpoint**

---

# 2. Defining Policies Using Policy Designer
The Policy Designer provides a visual interface to create, edit, and attach policies.

### Steps to Create a Policy
1. Select the **Flow segment** (PreFlow/PostFlow/Conditional Flow).
2. Select the **policy type** from prebuilt policies.
3. Configure policy details in the editor.
4. Optionally add **conditional execution logic**.
5. Attach the policy to **request** or **response** stream.
6. Save the flow and redeploy.

### Multiple Flow Attachment
Some policies must be attached to both request and response flows.

**Example:** Response Cache Policy
- Must be attached to: Request Flow + Response Flow

Use the **“+”** button under *Created Policies* to attach a policy to multiple flows.

---

# 3. Types of Policies in SAP API Management
Below is the complete list of **prebuilt** policies supported:

- Access Control
- Access Entity
- Assign Message
- Basic Authentication
- Extract Variables
- Invalidate Cache
- JavaScript
- JSON to XML
- Key Value Map Operations
- Lookup Cache
- Message Logging Policy
- OAuth v2.0 / GET / SET
- Populate Cache
- Python Script
- Quota
- Raise Fault
- Reset Quota
- Service Callout
- Spike Arrest
- SAML Assertion Policy
- SOAP Message Validation
- Verify API Key
- XML to JSON
- XSL Transform
- XML Threat Protection
- Regular Expression Protection
- JSON Threat Protection
- Response Cache
- Statistics Collector Policy

Predefined policy templates are available in **SAP Business Accelerator Hub**.

---

# 4. Applying Prebuilt Policies Using Policy Designer
Policies can be applied at different levels:
- ProxyEndpoint
- TargetEndpoint
- PreFlow
- PostFlow
- Conditional Flows
- PostClientFlows

If a specific PostClientFlow is not selected, the policy applies to **all** PostClientFlows.

---

# 5. Security Policies
SAP API Management provides multiple OWASP-based security policies.

Examples:
- Threat Protection (XML/JSON)
- Regular Expression Protection
- Spike Arrest
- OAuth2 Policies
- API Key Validation

SAP also provides a **Security Policy Blog Series** showcasing best practices.

---

# 6. Logging & Monitoring Policies
- **Message Logging Policy** can route logs to platforms like Splunk, Loggly, SumoLogic.

Examples:
- Splunk Logging Blog
- Loggly Logging Blog

---

# 7. Using Predefined Policies from SAP Business Accelerator Hub
You can import pre-made policy templates.

### Steps
1. Go to **https://api.sap.com**.
2. Navigate to **Categories → APIs**.
3. Open **Policy Templates** tab.
4. Download the policy template (`.zip`).
5. In Integration Suite → Policy Templates → Import.
6. Open the API → Policy Editor → Edit.
7. Choose **Apply Template**.
8. Select the imported template and apply.
9. Save & redeploy.

Example Template: **Performance_Traceability**
- Flow Type: ProxyEndpoint PreFlow
- Contains: JavaScript Logic

---

# 8. Summary
Policies define API behavior and can be used for:
- Security
- Transformations
- Traffic Control
- Logging & Monitoring
- Scripting

SAP provides both prebuilt policies and policy templates.

---

# 9. 4W & 1H (Understanding Policies)

| **4W & 1H** | **Description** |
|------------|-----------------|
| **What** | Policies are runtime programs that secure, transform, and manage APIs. |
| **When** | When API behavior needs modification without backend changes. |
| **Where** | SAP Integration Suite → API Management → Policy Designer. |
| **Why** | To enhance security, control traffic, transform data, log interactions, and reuse logic. |
| **How** | Attach prebuilt or custom policies via Policy Designer or import templates from API Hub. |

---

# 10. Exercises

## **Exercise 1: Add Basic Authentication Against ES5 System**
### Task Flow
- Add Message Policy
- Add Basic Authentication Policy
- Test API Proxy
- Monitor API Calls

---

## **Exercise 2: Explore API & Policies on SAP Business Accelerator Hub**
### Task Flow
- Log in to **https://api.sap.com**
- Explore policy templates
- Explore API artifacts

### Outcome
You will understand available APIs and policy templates for rapid development.




# trainer 1
https://learnsap.enable-now.cloud.sap/pub/mmcp/index.html?show=project!PR_8A41C4D723DD2B91:uebung#38

# trainer 2
https://learnsap.enable-now.cloud.sap/pub/mmcp/index.html?show=project!PR_CD65ADDEBB0DB28F:uebung

